# 开发 Babel Plugin
https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-avoid-traversing-the-ast-as-much-as-possible

## visitor
### paths
AST 通常会有很多节点，那么节点之间的关联关系可以用 paths 来简化表示。
path 是两个节点之间连接的对象。 path 对象还有添加，更新，移动和删除节点有关的很多方法。
在某种意义上，path 是一个节点在AST中的位置，以及关于该节点各种信息的响应式Reactive表示。
当调用一个修改AST的方法后，路径信息也会被更新。
```js
// 一个节点如下
{
  type: 'FunctionDeclaration',
  id: {
    type: 'Identifier',
    name: 'square'
  },
  ...
}

// 将子节点 Identifier 表示为一个path，如下
{
  "parent": {
    "type": "FunctionDeclaration",
    "id": {...}
  },
  "node": {
    "type": "Identifier",
    "name": "square"
  }
}
// 完整的path对象还包含其他属性数据
{
  "parent": {},
  "node": {},
  "hub": {},
  "contexts": [],
  "data": {},
  "shouldSkip": false,
  "shouldStop": false,
  "removed": false,
  "state": null,
  "opts": null,
  "skipKeys": null,
  "parentPath": null,
  "context": null,
  "container": null,
  "listKey": null,
  "inList": false,
  "parentKey": null,
  "key": null,
  "scope": null,
  "type": null,
  "typeAnnotation": null
}

```

## paths in visitors
在visitor中定义的方法，实际上是在访问path而非AST节点。

## state， scope， binding
找出使用一个变量的所有引用，我们只想在给定的scope中找出这些引用。  
scope可以表示为如下形式：
```js
{
  path: path,
  block: path.node,
  parentBlock: path.parent,
  parent: parentScope,
  bindings: [...]
}
```
当创建一个新的作用域时，需要给出它的路径和父作用域，之后在遍历过程中它会在该作用域内收集所有的引用（binding）。
一旦引用收集完毕，你就可以在作用域（scope）上使用各种方法。
所有引用属于特定的作用域，引用和作用域的这种关系被称作：绑定binding.
binding对象的形式如下：
```js
{
  identifier: node,
  scope: scope,
  path: path,
  kind: 'var',

  referenced: true,
  references: 3,
  referencePaths: [path, path, path],

  constant: false,
  constantViolations: [path]
}
```
