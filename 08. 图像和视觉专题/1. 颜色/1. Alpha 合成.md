
# Alpha 合成 （alpha compositing）
Alpha合成是一种将图像与背景结合的过程，结合后可以产生部分透明或全透明的`视觉效果`。  
渲染图像时，通常会将目标图像中的多个子元素单独渲染，最后再把多张子元素的图片合成为单独的图像。

要正确结合图像元素，每个元素的必须有对应的遮片 Matte (filmmaking)。遮片包含覆盖范围信息（图中几何对象的形状）可以借此分辨图像中的任意位置到底是被绘制的几何对象本身，还是逻辑上的“空白”区域。     

图像中使用的Alpha通道通常有两种表示形式：平直Alpha（straight alpha）和预乘Alpha（premultiplied alpha）。
1. 平直Alpha，图像中的RGB分量仅表示像素的颜色，与是否透明无关。   
2. 预乘Alpha，图像中的RGB分量也表示像素的颜色，但事先已经和不透明度做了乘法。某些使用场景下，这样的做法可以在后续合成时节省一次乘法。不过预乘Alpha的最显著优势在于使用简单、准确而非性能。    
平直 alpha 和 预乘 alpha 的转换关系：平直 alpha (0, 0.7, 0, 0.5) 等价于 预乘 alpha (0, 0.7 * 0.5, 0, 0.5).

有了Alpha通道，图片的合成操作就可以用合成代数的形式表达。假设有图像元素 A 和 B，最常见的合成操作就是把 A 作为前景、B 作为背景，我们称这种操作为 over，记作 A over B.    
最终结果的公式如下：( straight alpha )      
合成颜色：  A的颜色 * A的透明度 + B的颜色 * B的透明度 * ( 1 - A的颜色透明度)       
合成颜色的透明度： A的透明度 + B的透明度 *  ( 1 - A的颜色透明度) 
显示结果：合成颜色 / 合成透明度

C = (Ca * Aa + Cb * Ab * (1 - Aa)) / (Aa + Ab * (1 - Aa))

## over 运算的推导证明过程
1. 满足结合率 （A over B）over C  === A over (B over C)
将上述公式代入到结合律等式的左边，然后逐项展开再结合，最终可以得到等式右边的结论。
2. 如果 A 的透明度为1，结果为A，如果 A 的透明度为0， 结果为 B over C


# ？问题： composite 和 blend 的区别




# 参考文献
> 1. [Alpha合成](https://zh.wikipedia.org/zh-hans/Alpha%E5%90%88%E6%88%90)
